<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Chamados</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .hidden { display: none; }
    .blink { animation: blinkHighlight 1s infinite; }
    @keyframes blinkHighlight {
      0%, 50%, 100% { background-color: transparent; }
      25%, 75% { background-color: #ffcccc; }
    }
  </style>
</head>
<body class="bg-gray-100">

  <!-- Login -->
  <div id="loginScreen" class="flex items-center justify-center h-screen">
    <div class="bg-white p-6 rounded shadow-md w-96">
      <h2 class="text-2xl font-bold mb-4 text-center">Login</h2>
      <form id="loginForm" class="space-y-4">
        <input type="text" id="loginUser" placeholder="Usu√°rio" class="w-full p-2 border rounded">
        <input type="password" id="loginPass" placeholder="Senha" class="w-full p-2 border rounded">
        <button type="submit" class="w-full bg-blue-600 text-white p-2 rounded">Entrar</button>
      </form>
    </div>
  </div>

  <!-- Sistema -->
  <div id="systemScreen" class="hidden p-6">
    <div class="flex justify-between items-center mb-4">
      <h1 class="text-3xl font-bold">üìå Sistema de Chamados</h1>
      <div>
        <button id="btnConfig" class="bg-gray-600 text-white px-4 py-2 rounded">‚öôÔ∏è Configura√ß√µes</button>
        <button id="logoutBtn" class="bg-red-600 text-white px-4 py-2 rounded">Sair</button>
      </div>
    </div>

    <!-- Form Chamado -->
    <form id="ticketForm" class="grid grid-cols-2 gap-4 bg-white p-4 rounded shadow">
      <input id="subject" placeholder="Assunto" class="p-2 border rounded" required>
      <input id="client" placeholder="Cliente" class="p-2 border rounded" required>
      <input id="tech" placeholder="T√©cnico" class="p-2 border rounded" required>
      <select id="priority" class="p-2 border rounded">
        <option value="low">Baixa</option>
        <option value="medium">M√©dia</option>
        <option value="high">Alta</option>
        <option value="critical">Cr√≠tica</option>
      </select>
      <textarea id="description" placeholder="Descri√ß√£o" class="col-span-2 p-2 border rounded"></textarea>
      <button type="submit" class="bg-blue-600 text-white p-2 rounded">Salvar Chamado</button>
      <button type="button" id="cancelEditBtn" class="hidden bg-gray-500 text-white p-2 rounded">Cancelar</button>
    </form>

    <!-- Lista -->
    <table class="w-full mt-6 bg-white rounded shadow">
      <thead>
        <tr class="bg-gray-200">
          <th class="px-4 py-2 hidden">ID</th>
          <th class="px-4 py-2">Assunto</th>
          <th class="px-4 py-2">Cliente</th>
          <th class="px-4 py-2">T√©cnico</th>
          <th class="px-4 py-2">Prioridade</th>
          <th class="px-4 py-2">Status</th>
          <th class="px-4 py-2">A√ß√µes</th>
        </tr>
      </thead>
      <tbody id="ticketsList"></tbody>
    </table>
  </div>

  <!-- Tela Usu√°rios -->
  <div id="usersScreen" class="hidden p-6">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-2xl font-bold">üë§ Cadastro de Usu√°rios</h2>
      <button id="backBtn" class="bg-gray-600 text-white px-4 py-2 rounded">‚¨Ö Voltar</button>
    </div>
    <form id="userForm" class="grid grid-cols-2 gap-4 bg-white p-4 rounded shadow">
      <input id="userName" placeholder="Nome" class="p-2 border rounded" required>
      <input id="userLogin" placeholder="Usu√°rio" class="p-2 border rounded" required>
      <input type="password" id="userPass" placeholder="Senha" class="p-2 border rounded" required>
      <select id="userRole" class="p-2 border rounded">
        <option value="admin">Administrador</option>
        <option value="tech">T√©cnico</option>
        <option value="operator">Operador</option>
      </select>
      <button type="submit" class="col-span-2 bg-green-600 text-white p-2 rounded">Cadastrar Usu√°rio</button>
    </form>

    <h3 class="text-xl font-bold mt-6">Usu√°rios Cadastrados</h3>
    <ul id="usersList" class="mt-2 bg-white p-4 rounded shadow"></ul>
  </div>

  <script>
    let tickets = JSON.parse(localStorage.getItem("tickets")) || [];
    let users = JSON.parse(localStorage.getItem("users")) || [
      {name:"Admin", login:"admin", pass:"123", role:"admin"}
    ];
    let currentUser = null;
    let editTicketId = null;

    // ===== Login =====
    document.getElementById("loginForm").addEventListener("submit", e=>{
      e.preventDefault();
      const user = document.getElementById("loginUser").value;
      const pass = document.getElementById("loginPass").value;
      const found = users.find(u=>u.login===user && u.pass===pass);
      if(found){
        currentUser = found;
        document.getElementById("loginScreen").classList.add("hidden");
        document.getElementById("systemScreen").classList.remove("hidden");
        renderTickets();
      } else {
        alert("Usu√°rio ou senha inv√°lidos!");
      }
    });

    document.getElementById("logoutBtn").addEventListener("click", ()=>{
      currentUser = null;
      document.getElementById("systemScreen").classList.add("hidden");
      document.getElementById("usersScreen").classList.add("hidden");
      document.getElementById("loginScreen").classList.remove("hidden");
    });

    // ===== Tickets =====
    document.getElementById("ticketForm").addEventListener("submit", e=>{
      e.preventDefault();
      const newTicket = {
        id: editTicketId || Date.now(),
        subject: document.getElementById("subject").value,
        client: document.getElementById("client").value,
        tech: document.getElementById("tech").value,
        priority: document.getElementById("priority").value,
        description: document.getElementById("description").value,
        status: editTicketId ? tickets.find(t=>t.id===editTicketId).status : "open"
      };
      if(editTicketId){
        tickets = tickets.map(t=>t.id===editTicketId ? newTicket : t);
        editTicketId = null;
      } else {
        tickets.push(newTicket);
      }
      localStorage.setItem("tickets", JSON.stringify(tickets));
      document.getElementById("ticketForm").reset();
      document.getElementById("cancelEditBtn").classList.add("hidden");
      renderTickets();
    });

    document.getElementById("cancelEditBtn").addEventListener("click", ()=>{
      editTicketId = null;
      document.getElementById("ticketForm").reset();
      document.getElementById("cancelEditBtn").classList.add("hidden");
    });

    function renderTickets(){
      const ticketsList = document.getElementById("ticketsList");
      ticketsList.innerHTML = "";
      tickets.forEach(ticket=>{
        const tr = document.createElement("tr");
        tr.dataset.id = ticket.id;
        if(ticket.priority==="critical" && ticket.status!=="resolved") tr.classList.add("blink");

        let actionsHTML = "";
        if(ticket.status==="resolved"){
          actionsHTML = `<button class="details-btn btn-details">Detalhes</button>
                         <span class="text-green-600 font-bold ml-2">‚úÖ Encerrado</span>`;
        } else {
          actionsHTML = `<button class="edit-btn btn-edit">Editar</button>
                         <button class="close-btn btn-close">Encerrar</button>
                         <button class="details-btn btn-details">Detalhes</button>`;
        }

        tr.innerHTML = `
          <td class="border px-4 py-2 hidden">${ticket.id}</td>
          <td class="border px-4 py-2">${ticket.subject}</td>
          <td class="border px-4 py-2">${ticket.client}</td>
          <td class="border px-4 py-2">${ticket.tech}</td>
          <td class="border px-4 py-2 capitalize">${translatePriority(ticket.priority)}</td>
          <td class="border px-4 py-2 capitalize">${translateStatus(ticket.status)}</td>
          <td class="border px-4 py-2 space-x-2">${actionsHTML}</td>`;
        ticketsList.appendChild(tr);
      });

      // eventos
      document.querySelectorAll(".edit-btn").forEach(btn=>{
        btn.addEventListener("click", ()=> editTicket(parseInt(btn.closest("tr").dataset.id)));
      });
      document.querySelectorAll(".close-btn").forEach(btn=>{
        btn.addEventListener("click", ()=> closeTicket(parseInt(btn.closest("tr").dataset.id)));
      });
      document.querySelectorAll(".details-btn").forEach(btn=>{
        btn.addEventListener("click", ()=> showDetails(parseInt(btn.closest("tr").dataset.id)));
      });
    }

    function editTicket(id){
      const ticket = tickets.find(t=>t.id===id);
      if(!ticket || ticket.status==="resolved") return;
      editTicketId = id;
      document.getElementById("subject").value = ticket.subject;
      document.getElementById("client").value = ticket.client;
      document.getElementById("tech").value = ticket.tech;
      document.getElementById("priority").value = ticket.priority;
      document.getElementById("description").value = ticket.description;
      document.getElementById("cancelEditBtn").classList.remove("hidden");
    }

    function closeTicket(id){
      tickets = tickets.map(t=>t.id===id ? {...t, status:"resolved"} : t);
      localStorage.setItem("tickets", JSON.stringify(tickets));
      renderTickets();
    }

    function showDetails(id){
      const ticket = tickets.find(t=>t.id===id);
      alert(`Assunto: ${ticket.subject}\nCliente: ${ticket.client}\nT√©cnico: ${ticket.tech}\nPrioridade: ${translatePriority(ticket.priority)}\nStatus: ${translateStatus(ticket.status)}\nDescri√ß√£o: ${ticket.description}`);
    }

    function translatePriority(p){ return {low:"Baixa",medium:"M√©dia",high:"Alta",critical:"Cr√≠tica"}[p]; }
    function translateStatus(s){ return {open:"Aberto",resolved:"Encerrado"}[s]; }

    // ===== Usu√°rios =====
    document.getElementById("btnConfig").addEventListener("click", ()=>{
      if(currentUser.role!=="admin"){ alert("Acesso restrito!"); return; }
      document.getElementById("systemScreen").classList.add("hidden");
      document.getElementById("usersScreen").classList.remove("hidden");
      renderUsers();
    });

    document.getElementById("backBtn").addEventListener("click", ()=>{
      document.getElementById("usersScreen").classList.add("hidden");
      document.getElementById("systemScreen").classList.remove("hidden");
    });

    document.getElementById("userForm").addEventListener("submit", e=>{
      e.preventDefault();
      const newUser = {
        name: document.getElementById("userName").value,
        login: document.getElementById("userLogin").value,
        pass: document.getElementById("userPass").value,
        role: document.getElementById("userRole").value
      };
      users.push(newUser);
      localStorage.setItem("users", JSON.stringify(users));
      e.target.reset();
      renderUsers();
    });

    function renderUsers(){
      const ul = document.getElementById("usersList");
      ul.innerHTML = "";
      users.forEach(u=>{
        const li = document.createElement("li");
        li.textContent = `${u.name} (${u.login}) - ${u.role}`;
        ul.appendChild(li);
      });
    }
  </script>
</body>
</html>
