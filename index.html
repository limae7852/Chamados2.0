<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Sistema de Chamados</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    
        <script src="https://cdn.emailjs.com/sdk/3.2.0/email.min.js"></script>
    <script>
      (function () {
        emailjs.init("service_gbo9njd"); // substitua aqui pelo seu User ID do EmailJS
      })();
    </script>

    <style>
        .ticket-card {
            transition: all 0.3s ease;
        }
        .ticket-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .modal {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .modal-hidden {
            opacity: 0;
            transform: translateY(20px);
            pointer-events: none;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <header class="mb-8">
            <h1 class="text-3xl font-bold text-blue-800">Sistema de Chamados</h1>
            <p class="text-gray-600">Gerencie seus chamados de forma eficiente</p>
        </header>

        <div class="flex flex-col md:flex-row gap-6 mb-8">
            <div class="w-full md:w-1/4 bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4 text-gray-800">Opções</h2>
                <button onclick="openCreateModal()" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded mb-3 flex items-center justify-center">
                    <i class="fas fa-plus mr-2"></i> Novo Chamado
                </button>
                <button onclick="sendEmailToAll()" class="w-full bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded flex items-center justify-center">
                    <i class="fas fa-envelope mr-2"></i> Enviar E-mails
                </button>
            </div>

            <div class="w-full md:w-3/4">
                <div class="bg-white p-6 rounded-lg shadow">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-semibold text-gray-800">Chamados Abertos</h2>
                        <div class="relative">
                            <input type="text" id="searchInput" placeholder="Buscar chamados..." class="border border-gray-300 rounded-md py-2 px-4 pl-10 focus:outline-none focus:ring-2 focus:ring-blue-500" />
                            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                        </div>
                    </div>

                    <div id="ticketsContainer" class="space-y-4">
                                            </div>
                </div>
            </div>
        </div>
    </div>

        <div id="ticketModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 modal modal-hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md">
            <div class="flex justify-between items-center border-b p-4">
                <h3 class="text-lg font-semibold" id="modalTitle">Novo Chamado</h3>
                <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-4">
                <form id="ticketForm">
                    <input type="hidden" id="ticketId" />
                    <div class="mb-4">
                        <label for="title" class="block text-gray-700 mb-2">Título</label>
                        <input
                            type="text"
                            id="title"
                            required
                            class="w-full border border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        />
                    </div>
                    <div class="mb-4">
                        <label for="description" class="block text-gray-700 mb-2">Descrição</label>
                        <textarea
                            id="description"
                            rows="4"
                            required
                            class="w-full border border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        ></textarea>
                    </div>
                    <div class="mb-4">
                        <label for="priority" class="block text-gray-700 mb-2">Prioridade</label>
                        <select
                            id="priority"
                            class="w-full border border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        >
                            <option value="Baixa">Baixa</option>
                            <option value="Média">Média</option>
                            <option value="Alta">Alta</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label for="email" class="block text-gray-700 mb-2">E-mail para contato</label>
                        <input
                            type="email"
                            id="email"
                            required
                            class="w-full border border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        />
                    </div>
                </form>
            </div>
            <div class="flex justify-end border-t p-4">
                <button onclick="closeModal()" class="mr-2 bg-gray-300 hover:bg-gray-400 text-gray-800 py-2 px-4 rounded">
                    Cancelar
                </button>
                <button onclick="saveTicket()" class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded">
                    Salvar
                </button>
            </div>
        </div>
    </div>

        <div id="emailModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 modal modal-hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md">
            <div class="flex justify-between items-center border-b p-4">
                <h3 class="text-lg font-semibold">Enviar E-mail</h3>
                <button onclick="closeEmailModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-4">
                <div class="mb-4">
                    <label for="emailSubject" class="block text-gray-700 mb-2">Assunto</label>
                    <input
                        type="text"
                        id="emailSubject"
                        class="w-full border border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        value="Atualização sobre seu chamado"
                    />
                </div>
                <div class="mb-4">
                    <label for="emailMessage" class="block text-gray-700 mb-2">Mensagem</label>
                    <textarea
                        id="emailMessage"
                        rows="4"
                        class="w-full border border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    >Prezado cliente,

Agradecemos pelo seu contato. Estamos trabalhando para resolver seu chamado o mais breve possível.

Atenciosamente,
Equipe de Suporte</textarea>
                </div>
            </div>
            <div class="flex justify-end border-t p-4">
                <button
                    onclick="closeEmailModal()"
                    class="mr-2 bg-gray-300 hover:bg-gray-400 text-gray-800 py-2 px-4 rounded"
                >
                    Cancelar
                </button>
                <button
                    onclick="confirmSendEmail()"
                    class="bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded"
                >
                    Enviar
                </button>
            </div>
        </div>
    </div>

    <script>
        let tickets = [
            {
                id: 1,
                title: "Problema com login",
                description: "Não consigo acessar minha conta mesmo com a senha correta.",
                priority: "Alta",
                email: "cliente1@exemplo.com",
                status: "Aberto",
                createdAt: new Date(),
            },
            {
                id: 2,
                title: "Erro no sistema de pagamento",
                description: "Ao tentar finalizar a compra, recebo mensagem de erro.",
                priority: "Média",
                email: "cliente2@exemplo.com",
                status: "Aberto",
                createdAt: new Date(Date.now() - 86400000), // Ontem
            },
        ];

        const ticketsContainer = document.getElementById("ticketsContainer");
        const searchInput = document.getElementById("searchInput");
        const ticketModal = document.getElementById("ticketModal");
        const emailModal = document.getElementById("emailModal");
        const modalTitle = document.getElementById("modalTitle");
        const ticketForm = document.getElementById("ticketForm");
        const ticketIdInput = document.getElementById("ticketId");
        const titleInput = document.getElementById("title");
        const descriptionInput = document.getElementById("description");
        const priorityInput = document.getElementById("priority");
        const emailInput = document.getElementById("email");

        document.addEventListener("DOMContentLoaded", () => {
            renderTickets();

            searchInput.addEventListener("input", (e) => {
                const searchTerm = e.target.value.toLowerCase();
                const filteredTickets = tickets.filter(
                    (ticket) =>
                        ticket.title.toLowerCase().includes(searchTerm) ||
                        ticket.description.toLowerCase().includes(searchTerm) ||
                        ticket.email.toLowerCase().includes(searchTerm)
                );
                renderTickets(filteredTickets);
            });
        });

        function renderTickets(ticketsToRender = tickets) {
            ticketsContainer.innerHTML = "";

            if (ticketsToRender.length === 0) {
                ticketsContainer.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-ticket-alt text-4xl mb-2"></i>
                        <p>Nenhum chamado encontrado</p>
                    </div>
                `;
                return;
            }

            ticketsToRender.forEach((ticket) => {
                const priorityColors = {
                    Baixa: "bg-green-100 text-green-800",
                    Média: "bg-yellow-100 text-yellow-800",
                    Alta: "bg-red-100 text-red-800",
                };

                const dateOptions = { day: "2-digit", month: "2-digit", year: "numeric" };
                const formattedDate = ticket.createdAt.toLocaleDateString("pt-BR", dateOptions);

                ticketsContainer.innerHTML += `
                    <div class="ticket-card bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-semibold text-lg text-gray-800">${ticket.title}</h3>
                            <span class="text-xs text-gray-500">${formattedDate}</span>
                        </div>
                        <p class="text-gray-600 mb-3">${ticket.description}</p>
                        <div class="flex justify-between items-center">
                            <div class="flex items-center space-x-3">
                                <span class="text-xs px-2 py-1 rounded-full ${priorityColors[ticket.priority]}">
                                    ${ticket.priority}
                                </span>
                                <span class="text-xs text-gray-500">${ticket.email}</span>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="openEmailModal(${ticket.id})" class="text-blue-500 hover:text-blue-700" title="Enviar e-mail">
                                    <i class="fas fa-envelope"></i>
                                </button>
                                <button onclick="editTicket(${ticket.id})" class="text-yellow-500 hover:text-yellow-700" title="Editar">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="deleteTicket(${ticket.id})" class="text-red-500 hover:text-red-700" title="Excluir">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        function openCreateModal() {
            ticketForm.reset();
            ticketIdInput.value = "";
            modalTitle.textContent = "Novo Chamado";
            ticketModal.classList.remove("modal-hidden");
        }

        function openEditModal(ticket) {
            ticketIdInput.value = ticket.id;
            titleInput.value = ticket.title;
            descriptionInput.value = ticket.description;
            priorityInput.value = ticket.priority;
            emailInput.value = ticket.email;
            modalTitle.textContent = "Editar Chamado";
            ticketModal.classList.remove("modal-hidden");
        }

        function closeModal() {
            ticketModal.classList.add("modal-hidden");
        }

        function openEmailModal(ticketId = null) {
            if (ticketId) {
                const ticket = tickets.find((t) => t.id === ticketId);
                document.getElementById("emailSubject").value = `Atualização sobre seu chamado: ${ticket.title}`;
            }
            emailModal.classList.remove("modal-hidden");
        }

        function closeEmailModal() {
            emailModal.classList.add("modal-hidden");
        }

        function saveTicket() {
            const id = ticketIdInput.value;
            const ticketData = {
                title: titleInput.value,
                description: descriptionInput.value,
                priority: priorityInput.value,
                email: emailInput.value,
                status: "Aberto",
                createdAt: id ? tickets.find((t) => t.id == id).createdAt : new Date(),
            };

            if (id) {
                const index = tickets.findIndex((t) => t.id == id);
                tickets[index] = { ...tickets[index], ...ticketData };
            } else {
                const newId = tickets.length > 0 ? Math.max(...tickets.map((t) => t.id)) + 1 : 1;
                ticketData.id = newId;
                tickets.push(ticketData);
            }

            renderTickets();
            closeModal();
        }

        function editTicket(id) {
            const ticket = tickets.find((t) => t.id === id);
            if (ticket) {
                openEditModal(ticket);
            }
        }

        function deleteTicket(id) {
            if (confirm("Tem certeza que deseja excluir este chamado?")) {
                tickets = tickets.filter((t) => t.id !== id);
                renderTickets();
            }
        }

        function sendEmailToAll() {
            if (tickets.length === 0) {
                alert("Não há chamados para enviar e-mails.");
                return;
            }
            openEmailModal();
        }

        function confirmSendEmail() {
            const subject = document.getElementById("emailSubject").value;
            const message = document.getElementById("emailMessage").value;

            tickets.forEach((ticket) => {
                const templateParams = {
                    to_email: ticket.email,
                    subject: subject,
                    message: message.replace(/\n/g, "<br>"),
                    ticket_title: ticket.title,
                };

                emailjs
                    .send("service_gbo9njd", "template_fptlzup", templateParams)
                    .then(
                        function (response) {
                            console.log("E-mail enviado para", ticket.email, response.status, response.text);
                        },
                        function (error) {
                            console.error("Erro ao enviar e-mail para", ticket.email, error);
                        }
                    );
            });

            alert("Solicitação de envio de e-mails disparada!");
            closeEmailModal();
        }
    </script>
</body>
</html>
